## Контент задач (ручные правки)

В репозитории есть два источника текста задачи:

1) **База** — `tasks_clean.jsonl` (генерируется скриптами, руками не правим).
2) **Оверрайды** — отдельные файлы `frontend/content/tasks/<INTERNAL_ID>.mdx` (правим руками/через dev‑редактор).

При наличии `frontend/content/tasks/<INTERNAL_ID>.mdx` именно он считается «источником правды» для полей, которые в нём указаны.
Если оверрайда нет — всё работает как сейчас (рендерится HTML из `question_html_clean`).

### Нейминг и поиск

- Ключ для оверрайда — `internal_id` задачи.
- Для поиска/маппинга `internal_id` нормализуем к `UPPERCASE`.
- Файлы оверрайдов называем `frontend/content/tasks/<INTERNAL_ID_UPPER>.mdx`.

### Формат `*.mdx`

Файл состоит из:

- YAML frontmatter (метаданные задачи),
- затем пустая строка,
- затем Markdown‑тело (без обязательного JSX).

Поддерживаемые поля frontmatter (минимум):

- `answer_type`: строка (например `short_answer`, `single_choice`, `multiple_choice` и т.п.)
- `kes`: массив кодов КЭС (например `["3.3", "3.4"]`)
- `hint`: строка (можно пустую)
- `options`: массив вариантов для задач с выбором ответа:
  - `value`: строка/число (как в текущем JSON)
  - `text`: Markdown/текст варианта

Тело файла — это текст задачи в Markdown (GFM).

### Разметка

- **Таблицы:** предпочитаем GFM‑таблицы. Сложные таблицы (colspan/rowspan) допустимо вставлять как raw HTML.
- **Математика:** пишем TeX‑формулы в `$...$` (inline) и `$$...$$` (display). Не смешиваем «кусочки» формулы между math/text: лучше `$12 = 1100_{2}$`, чем `12 = $1100_{2}$` или `$12$ = $1100_{2}$`. Текущий рендер поддерживает также MathML из базы.
  - Для задач №5 дополнительно стараемся держать в math и переменные (`$N$`, `$R$`), и числовые константы (`$3$`, `$162$` и т.п.), чтобы не было смешения шрифтов.
- **Картинки/ассеты:** пока не добавляем новые через админку; в тексте допускаем ссылки вида `assets/<file>` (совместимо с `frontend/public/assets`).

### Правила слияния (base + override)

- Поля из `*.mdx` имеют приоритет над `tasks_clean.jsonl`.
- Неуказанные в оверрайде поля берём из базы (чтобы миграция была постепенной).

## Dev‑редактирование (не прод)

- Режим редактирования доступен только в dev (`import.meta.env.DEV`).
- Сохранение пишет/обновляет `frontend/content/tasks/<INTERNAL_ID_UPPER>.mdx`.
- Коммиты делаем вручную.

## Артефакты сборки

- `frontend/public/task_overrides.json` — скомпилированный индекс оверрайдов для клиента (генерируется, руками не правим).

## Генерация `*.mdx` из базы

Для старта правок можно сгенерировать заготовку оверрайда из `tasks_clean.jsonl`:

- `uv run python generate_task_mdx.py --internal-id 09DBe5`

Скрипт конвертирует `question_html_clean` в Markdown и, в частности, переводит индексы из HTML в TeX (например `111<sub>10</sub>` → `$111_{10}$`).
